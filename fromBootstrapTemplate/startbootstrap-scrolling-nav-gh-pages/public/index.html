<!doctype html>
<html lang="en">

<head>
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="/__/firebase/7.14.2/firebase-app.js"></script>
    <script src="/__/firebase/7.14.2/firebase-auth.js"></script>
    <script src="/__/firebase/7.14.2/firebase-database.js"></script>
    <script src="/__/firebase/init.js"></script>
    <script src="js/taskManager.js"></script>

    <script src="js/mandatoryFileHeading.js"></script>
    <script src="js/auth.js"></script>
    <style>

        * {
            box-sizing: border-box;
        }

        ul {
            margin: 0;
            padding: 0;
        }

        ul li {
            cursor: pointer;
            position: relative;
            padding: 12px 8px 12px 40px;
            background: #eee;
            font-size: 18px;
            transition: 0.2s;

            /* make the list items unselectable */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* Set all odd list items to a different color (zebra-stripes) */
        ul li:nth-child(odd) {
            background: #f9f9f9;
        }

        ul li:hover {
            background: #ddd;
        }

        /* Style the close button */

        .remove-task:hover {
            background-color: #f44336;
            color: white;
        }

        .show-hide {
            display: none;
        }
    </style>
    <script>
       $(document).ready(function() {
 
            $(":button").click(function(event){
                if($(this).prop("id") == "high"){
                    $("#aBtnGroup").val("High");
                } else if($(this).prop("id") == "medium") {
                    $("#aBtnGroup").val("Medium");
                } else {
                    $("#aBtnGroup").val("Low");
                }
            
            });

            

            //Date formatting function
            function dateFormatting(p1) {
                var month = p1.getMonth() + 1;
                var day = p1.getDate();
                var year = p1.getFullYear();
                var d  = ((month < 10) ? "0" + month : month);
                d += ((day < 10) ? "/0" : "/") + day;
                d += "/" + year;
                p1 = d;
                return p1;
            }

            $('#task-list').on("click", "li", function () {
                $(this).children(".show-hide").show();
            });

            $(document).on("click", "button.remove-task", function(){

                removeTask(getValue("uid"), () => {redirectPage("index.html")});
            });

            getTasks((taskArr)=>{

                for(var i = 0; i < taskArr.length; i++){
                    console.log(taskArr[i]);
                    var taskList = "";
                    var taskUID = taskArr[i].uid;
                    var taskTitle = taskArr[i].title;
                    var taskDesc = taskArr[i].description;
                    var taskCat = taskArr[i].category;
                    var taskPrio = taskArr[i].priority;
                    var taskTime = taskArr[i].timer;
                    var taskDate = new Date(taskArr[i].due);
                    var dueDate = dateFormatting(taskDate);

                    taskList += 
                        "<li>" +
                            taskTitle
                            + "<ul class='show-hide'>" +
                                "<li>" +
                                    "Due Date: " + dueDate + " " + taskTime
                                + "</li>"
                                + "<li>" +
                                    "Description: " + taskDesc
                                + "</li>"
                                + "<li>" +
                                    "Category: " + taskCat
                                + "</li>"
                                + "<li>" +
                                    "Priority: " + taskPrio
                                + "</li>" 
                            + "<ul>"
                        + "</li>" + 
                        "<button class='remove-task' type='button'> Remove Task </button>" +
                        "<input type='hidden' id='uid' value='" + taskUID + "'>";

                    $("#task-list").append(taskList);

                    
                }
            });

            var myNodelist = document.getElementsByTagName("LI");
            var i;
            for (i = 0; i < myNodelist.length; i++) {
                var span = document.createElement("SPAN");
                var txt = document.createTextNode("\u00D7");
                span.className = "close";
                span.appendChild(txt);
                myNodelist[i].appendChild(span);
            }

            var list = document.querySelector('ul');
            list.addEventListener('click', function(ev) {
                if (ev.target.tagName === 'LI') {
                    ev.target.classList.toggle('checked');
                }
            }, false);

 
        }); 
    </script>

    <link rel="stylesheet" type="text/css" href="css/index-custom.css">
</head>
<body id="app-top" style="box-sizing: border-box!important;">
    <div id='task-container'>
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal-b5">Add Task</button>
        <div class="modal fade" id="modal-b5" tabindex="-1" role="dialog" aria-labelledby="modal-b5" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                            <div class="modal-body p-0">
                                <div class="card bg-secondary shadow-none border-0">
                                    <div class="card-header bg-white pb-5">
                                        <div class="card-body px-lg-5 text-left">
                                            <form role="form">
                                                <div class="form-group row">
                                                    <label for="title" class="col-sm-12 col-form-label"><i class="fas pr-2"></i>Title</label>
                                                    <div class="col-sm-12">
                                                        <input id="title" class="form-control requiredField" placeholder="Insert title here" type="title" required>
                                                    </div>
                                                    <label for="due-date" class="col-sm-12 col-form-label"><i class="fas pr-2"></i>Due Date</label>
                                                    <div class="col-sm-12">
                                                        <input id="due-date" class="form-control requiredField" placeholder="DD/MM/YYYY" type="date" required>
                                                    </div>
                                                    <label for="details" class="col-sm-12 col-form-label"><i class="fas pr-2"></i>Details</label>
                                                    <div class="col-sm-12">
                                                        <input id="details" class="form-control" type="details">
                                                    </div>
                                <label for="timer" class="col-sm-12 col-form-label"><i class="fas pr-2"></i>Timer</label>
                                                    <div class="col-sm-12">
                                                        <input id="timer" class="form-control requiredField" placeholder="HH:MM" type="time" required>
                                                    </div>
                                <label for="priority" class="col-sm-12 col-form-label"><i class="fas pr-2"></i>Priority</label>
                                <div id="aBtnGroup" class="btn-group">
                                    <button type="button" value="Low" class="btn btn-default" id="low">Low</button>
                                    <button type="button" value="Medium" class="btn btn-default" id="medium">Medium</button>
                                    <button type="button" value="High" class="btn btn-default" id="high">High</button>
                                  </div>
                                


                                                </div>
                            <div class="btn-group">
                                <select id="category">
                                    <option value="1" selected="selected">Category 1</option>
                                    <option value="2">Category 2</option>
                                    <option value="3">Category 3</option>
                                </select>
                            </div>
                            <nav aria-label="Priority Selection">
                                </div>
                                                </nav>
                                                <div class="text-center">
                                                    <button id="modClose" type="button" onclick="createTask(getValue('title'), getValue('due-date'), getValue('category'), '', getValue('aBtnGroup'), getValue('timer'), getValue('details'),() => {redirectPage('index.html')})" class="btn btn-info my-4">Create Task</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                    </div>
                </div>
            </div>
        </div>

      
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal-b6">Add Category</button>
        <div class="modal fade" id="modal-b6" tabindex="-1" role="dialog" aria-labelledby="modal-b6" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                            <div class="modal-body p-0">
                                <div class="card bg-secondary shadow-none border-0">
                                    <div class="card-header bg-white pb-5">
                                        <div class="card-body px-lg-5 text-left">
                                            <form role="form">
                                                <div class="form-group row">
                                                    <label for="title" class="col-sm-12 col-form-label"><i class="fas pr-2"></i>Title</label>
                                                    <div class="col-sm-12">
                                                        <input id="title" class="form-control requiredField" placeholder="Insert title here" type="title" required>
                                                    </div>
                                                    <label for="title" class="col-sm-12 col-form-label"><i class="fas pr-2"></i>Color</label>
                            
                                                    <div class="btn-group">
                                                                <select id="dropdown-color">
                                                                    <option value="Red" selected="selected">Red</option>
                                                                    <option value="Blue">Blue</option>
                                                                    <option value="Yellow">Yellow</option>
                                                                    <option value="Green">Green</option>
                                                                </select>
                                                    </div>


                                    </div>
                                        </label>
                                    </div>
                                    <div class="text-center">
                                        <button type="button" onclick="createTask('category_placeholder', '', getValue('title'), getValue('dropdown-color'), '', '', '', () => {redirectPage('index.html')})" class="btn btn-primary">Add Category</button>

                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div>
            <ul id="task-list">

            </ul>
        </div>


    </div>
</body>
</html>
