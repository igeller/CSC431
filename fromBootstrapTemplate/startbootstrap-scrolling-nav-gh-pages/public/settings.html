<!doctype html>
<html lang="en">

<head>
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>

    <script src="/__/firebase/7.14.2/firebase-app.js"></script>
    <script src="/__/firebase/7.14.2/firebase-auth.js"></script>
    <script src="/__/firebase/7.14.2/firebase-database.js"></script>
    <script src="/__/firebase/init.js"></script>

    <script src="js/mandatoryFileHeading.js"></script>
    <link rel="stylesheet" type="text/css" href="css/index-custom.css">

</head>
<body id="app-top" style="box-sizing: border-box!important;">
    <ul class="list-group mb-5">
    <li class="list-group-item d-flex bg-neutral-first justify-content-between align-items-center">
        Account
    </li>
    <li class="list-group-item d-flex justify-content-between align-items-center">
        <form>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="inputEmail46">New Email</label>
                    <input type="email" class="form-control" id="inputEmail4" placeholder="Email">
                </div>
                <div class="form-group col-md-6">
                    <label for="inputEmail46">Confirm Email</label>
                    <input type="email" class="form-control" id="inputEmail46" placeholder="Email">
                </div>
                <div class="form-group col-md-6">
                    <button id="confirmEmail" class="btn btn-sm bg-neutral-primary" type="button">Confirm</button>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-5">
                    <label for="inputPassword46">New Password</label>
                    <input type="password" class="form-control" id="inputPassword6" placeholder="Password">
                </div>
                <div class="form-group col-md-5">
                    <label for="inputPassword46">Confirm Password</label>
                    <input type="password" class="form-control" id="inputPassword46" placeholder="Password">
                </div>
                <div class="form-group col-md-5">
                    <button id="confirmPassword" class="btn btn-sm bg-neutral-primary" type="button">Confirm</button>
                </div>
            </div>
        </form>
    </li>
    <li class="list-group-item d-flex bg-neutral-first justify-content-between align-items-center">
        <p class="m-0 col-sm-auto">Categories</p>
        <button class="my-0 mr-5 alert-link text-dark text-left" data-toggle="modal" data-target="#modal-add-cat">+</button>
        <div class="modal fade" id="modal-add-cat" tabindex="-1" role="dialog" aria-labelledby="modalb1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered mx-auto col-lg-4" role="document">
                <div class="modal-content">
                    <div class="modal-body p-0">
                        <div class="card bg-secondary shadow-none border-0">
                            <div class="card-header bg-white">
                                <div class="text-dark text-center">
                                    <h3 class="m-0">Create New Category</h3>
                                </div>
                            </div>
                            <div class="card-body px-lg-5 text-left">
                                <form role="form">
                                    <div class="form-group row">
                                        <label for="categoryName" class="col-sm-12 col-form-label"><i class="fas fa-tags"></i>Category Name</label>
                                        <div class="col-sm-12">
                                            <input id="categoryName" class="form-control requiredField" placeholder="ex: Groceries" type="text">
                                        </div>
                                    </div>

                                    <div class="form-group row">
                                        <label for="categoryColor" class="col-sm-5 pr-0 col-form-label"><i class="fas fa-palette"></i>Category Color</label>
                                        <div id="pickr-container" class="col-sm-6 pl-0">
                                            <input id="categoryColor" class="form-control" value="Click to Color" type="color">
                                        </div>
                                    </div>

                                    <div class="text-center">
                                        <button id="modClose" type="button" onclick="createTask('title', '', getValue('categoryName'), getValue('categoryColor'), '', '', '', () => {redirectPage('settings.html')})" class="btn btn-info my-4">Create</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </li>
    <li id="categories-list" class="list-group-item d-flex">
        <!--<div id="category1" class="btn-group btn-group-split mr-3">
            <badge type="button" class="btn bg-neutral-danger btn-sm">Assignment</badge>
            <badge type="button" class="btn bg-neutral-danger btn-sm dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="sr-only">Toggle Dropdown</span>
            </badge>
            <div class="dropdown-menu">
                <a onclick="document.getElementById('category1').style.display = 'none'" class="dropdown-item" href="#">Delete</a>
            </div>
        </div>
        <div id="category2" class="btn-group btn-group-split mr-3">
            <badge type="button" class="btn bg-neutral-danger btn-sm">Reminder</badge>
            <badge type="button" class="btn bg-neutral-danger btn-sm dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="sr-only">Toggle Dropdown</span>
            </badge>
            <div class="dropdown-menu">
                <a onclick="document.getElementById('category2').style.display = 'none'" class="dropdown-item" href="#">Delete</a>
            </div>
        </div>
        <div id="category3" class="btn-group btn-group-split mr-3">
            <badge type="button" class="btn bg-neutral-danger btn-sm">Exam</badge>
            <badge type="button" class="btn bg-neutral-danger btn-sm dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="sr-only">Toggle Dropdown</span>
            </badge>
            <div class="dropdown-menu">
                <a onclick="document.getElementById('category3').style.display = 'none'" class="dropdown-item" href="#">Delete</a>
            </div>
        </div>-->
    </li>
    <li class="list-group-item d-flex bg-neutral-first justify-content-between align-items-center">
        Other
    </li>
    <li class="list-group-item d-flex">
        <div class="form-group">
            <button onclick="logout(); location.replace('login.html');" id="logoutButton" class="btn btn-sm bg-neutral-primary" type="button">Logout</button>
        </div>
    </li>
    </ul>
</body>

<!-- The core Firebase JS SDK is always required and must be listed first -->
<!-- Update Email -->
<script type="text/javascript">
    document.getElementById("confirmEmail").onclick = function fun() {
        var newEmail = getValue('inputEmail4');
        var newEmail2 = getValue('inputEmail46');
        if (newEmail != newEmail2) {
                    $("#modal-b1").modal('toggle');
               $('body').prepend(`<div class="alert d-flex align-items-center pl-2 align-content-center alert-danger alert-dismissible fade show" role="alert">
    <span class="font-size-lg d-block d-40 mr-2 text-center">
        <i class="far fa-life-ring"></i>
    </span>
    <span>
        <strong class="d-block">The emails must match!</strong>
    </span>
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">×</span>
    </button>
</div>`)
        } else {
            updateUserEmail(newEmail, () => {
                console.log('updated email successfully');
            }, (error) => {
                console.log(error);
            })
        }
    }
</script>
    
<!-- Update Password -->
<script type="text/javascript">
    document.getElementById("confirmPassword").onclick = function fun() {
        var newPassword = getValue('inputPassword6');
        var newPassword2 = getValue('inputPassword46');
        if (newPassword != newPassword2) {
                    $("#modal-b1").modal('toggle');
               $('body').prepend(`<div class="alert d-flex align-items-center pl-2 align-content-center alert-danger alert-dismissible fade show" role="alert">
    <span class="font-size-lg d-block d-40 mr-2 text-center">
        <i class="far fa-life-ring"></i>
    </span>
    <span>
        <strong class="d-block">The passwords must match!</strong>
    </span>
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">×</span>
    </button>
</div>`)
        } else {
            updateUserPassword(newPassword, () => {
                console.log('updated password successfully');
            }, (error) => {
                console.log(error);
            })
        }
    }
</script>
    
<!-- Pull categories -->
<script src="js/taskManager.js"></script>
<script src="js/auth.js"></script>
<script type="text/javascript">
    var taskArray = [];
    var categories = [];
    var seen = false;
    html = '';
    function pullCategories(taskArray) {
        // Remove duplicate categories
        for (i=0; i < taskArray.length; i++) {
                for (j=0; j < categories.length; j++) {
                    if (taskArray[i].category == categories[j]) {
                        seen = true;
                        break;
                    }
                }
                if (seen == false) {
                    categories.push(taskArray[i].category);
                }
        }
        for (i=0; i < categories.length; i++) {
            // Construct html to append
            html += '<div id="category';
            html += i;
            html += '" class="btn-group btn-group-split mr-3"> <badge type="button" class="btn bg-neutral-danger btn-sm">';
            html += categories[i];
            html += '</badge><badge type="button" class="btn bg-neutral-danger btn-sm dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">';
            html += '<span class="sr-only">Toggle Dropdown</span></badge><div class="dropdown-menu">';
            html += '<a onclick="deleteCategory(taskArray, ';
            html += i;
            html += ")";
            html += '" class="dropdown-item" href="#">Delete</a></div></div>'
            document.getElementById('categories-list').innerHTML += html;
        }
    }
    getTasks(pullCategories);
</script>
    
<!-- Delete category -->
<script type="text/javascript">
    function deleteCategory(taskArray, categoryIndex) {
        // Remove category from taskArray
        for (i=0; i < taskArray.length; i++) {
                if (taskArray[i].category == categories[categoryIndex]) {
                    taskArray[i].category = "generic";
                }
        }
        document.getElementById("category"+categoryIndex).style.display = 'none';
    }
</script>
    
</html>

